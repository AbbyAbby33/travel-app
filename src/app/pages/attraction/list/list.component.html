<h2>景點列表</h2>

<div class="filter-group">
  <label for="category-select" class="filter-label">選擇分類</label>
  <select id="category-select" class="filter-select" [(ngModel)]="selectedCategory"
    (change)="onCategoryChange(selectedCategory)">
    @for (category of categories; track $index) {
    <option [value]="category.id">
      {{ category.name }}
    </option>
    }
  </select>
</div>

<span class="result-count">共 {{ totalCount }} 個景點</span>

<!-- 我的最愛操作 -->
@if (attractions.length > 0) {
<div class="batch-actions">
  <div class="batch-left">
    <label class="checkbox-label">
      <input type="checkbox" [checked]="isAllSelected()" (change)="toggleSelectAll()">
      <span> 全選</span>
    </label>
    @if (selectedAttractions.size > 0) {
      <span class="selected-count">
        已選 {{ selectedAttractions.size }} 項
      </span>
    }
  </div>

  <button class="btn" [disabled]="selectedAttractions.size === 0" (click)="addSelectedToFavorites()">
    加入我的最愛
  </button>
</div>
}

@if (loading) {
<!-- 載入中 -->
<div class="loading">
  <div class="spinner"></div>
  <p>載入中...</p>
</div>
} @else {
<!-- 列表 -->
<div class="attractions-list">
  @for (attraction of attractions; track attraction.id) {

  <div class="attractions-card">

    <!-- 圖片 -->
    @if(attraction.images && attraction.images.length > 0) {
    <div class="card-image">
      <img [src]="attraction.images[0].src" [alt]="attraction.name">
    </div>
    }

    <!-- 內容 -->
    <div class="card-content">

      <div class="favorite-operate">
        @if(isFavorite(attraction.id)) {
        <span>❤️</span>
        } @else {
        <div class="card-checkbox">
          <input type="checkbox" [checked]="isSelected(attraction.id)" (change)="toggleSelection(attraction.id)">
        </div>
        }
      </div>

      <h3 class="card-title">{{ attraction.name }}</h3>

      <p class="card-description">
        {{ attraction.introduction?.slice(0, 100) }}{{ attraction.introduction!.length > 100 ? '...' : '' }}
      </p>

      <div class="card-info">
        <div class="info-item">
          <span class="info-icon" aria-hidden="true">📍</span>
          <span class="info-text">{{ attraction.address }}</span>
        </div>

        <div class="info-item">
          <span class="info-icon" aria-hidden="true">📞</span>
          <span class="info-text">{{ attraction.tel }}</span>
        </div>
      </div>

    </div>
  </div>

  } @empty {
  <!-- 無資料 -->
  <div class="no-data">
    <p>找不到符合條件的景點</p>
  </div>
  }
</div>

<!-- 分頁 -->
@if (!loading && attractions.length > 0) {
<div class="pagination">
  <button class="page-btn" [disabled]="currentPage === 1" (click)="previousPage()">
    上一頁
  </button>

  <!-- 中間頁碼 -->
  <div class="page-numbers">
    @if (currentPage > 3) {
    <button class="page-number" (click)="goToPage(1)">
      1
    </button>
    }

    @if( currentPage > 3) {
    <span class="page-ellipsis">...</span>
    }

    @for (page of getPageRange(); track $index) {
    <button class="page-number" [class.active]="page === currentPage" (click)="goToPage(page)">
      {{ page }}
    </button>
    }

    @if (currentPage < totalPages - 2) { <span class="page-ellipsis">...</span>
      }

      @if (currentPage < totalPages - 2) { <button class="page-number" (click)="goToPage(totalPages)">
        {{ totalPages }}
        </button>
        }

  </div>

  <button class="page-btn" [disabled]="currentPage === totalPages" (click)="nextPage()">
    下一頁
  </button>
</div>
}

}